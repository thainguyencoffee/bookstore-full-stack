<div class="utils-container">
  <mat-form-field>
    <mat-label>Filter</mat-label>
    <input matInput (keyup)="applyFilter($event)" placeholder="Ex. Mia" #input>
  </mat-form-field>
  <button mat-flat-button *ngIf="clickedRows.size > 0" (click)="removeSelected()">Remove selected</button>
</div>

<div class="mat-elevation-z2">
  <mat-paginator #paginator
      [length]="dataSource.data.length"
      [pageIndex]="0"
      [pageSize]="10"
      [pageSizeOptions]="[5, 10, 20]"
      aria-label="Select page">
  </mat-paginator>

  <table mat-table class="full-width-table" [dataSource]="dataSource" matSort>
    <!-- Isbn Column -->
    <ng-container matColumnDef="isbn">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Isbn</th>
      <td mat-cell *matCellDef="let row" style="font-weight: bold">{{row.isbn}}
        @if(!copiedContent) {
          <button (click)="onCopyIsbn($event)" [cdkCopyToClipboard]="row.isbn" mat-icon-button [matTooltip]="'Copy ISBN'"><mat-icon>content_copy</mat-icon></button>
        }
        @if(copiedContent) {
          <span><mat-icon>check</mat-icon> Copied content!</span>
        }
      </td>
    </ng-container>

    <!-- Photo Column -->
    <ng-container matColumnDef="photo">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Photo</th>
      <td mat-cell *matCellDef="let row">
        <img class="photo" mat-card-avatar style="background-size: cover" width="100px" [src]="row.photo" alt="">
      </td>
    </ng-container>

    <!-- Title Column -->
    <ng-container matColumnDef="title">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Title</th>
      <td mat-cell *matCellDef="let row">{{row.title}}</td>
    </ng-container>

    <!-- Quantity Column -->
    <ng-container matColumnDef="quantity">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Quantity</th>
      <td mat-cell *matCellDef="let row">
        @if(row.inventory > 0) {
          {{row.quantity}}
          <button mat-flat-button (click)="increaseQuantity($event, row)" [class.btn-quantity-disable]="row.quantity >= row.inventory">+</button>
          <button mat-flat-button (click)="decreaseQuantity($event, row)">-</button>
        }
        @if(row.inventory == 0) {
          <span style="color: red">Out of stock</span>
        }
      </td>
    </ng-container>

    <!-- Price Column -->
    <ng-container matColumnDef="price">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Price</th>
      <td mat-cell *matCellDef="let row">{{row.price | currency:'VND':'symbol':'1.0-0'}}</td>
    </ng-container>

    <!-- TotalPrice Column -->
    <ng-container matColumnDef="totalPrice">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Total price</th>
      <td mat-cell *matCellDef="let row">{{row.totalPrice | currency:'VND':'symbol':'1.0-0'}}</td>
    </ng-container>

    <!-- Delete Column -->
    <ng-container matColumnDef="action_delete">
      <th mat-header-cell *matHeaderCellDef>Delete</th>
      <td mat-cell *matCellDef="let row">
        <button mat-icon-button (click)="deleteCartItem($event, row)">
          <mat-icon color="primary">delete</mat-icon>
        </button>
      </td>
    </ng-container>

    <!-- Checkout Column -->
    <ng-container matColumnDef="action_checkout">
      <th mat-header-cell *matHeaderCellDef>Checkout</th>
      <td mat-cell *matCellDef="let row">
        <button mat-icon-button (click)="checkout(row.isbn)" [disabled]="row.quantity == 0">
          <mat-icon>shopping_cart_checkout</mat-icon>
        </button>
      </td>
    </ng-container>

    <!--Header-->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <!--Row-->
    <tr
      mat-row
      (click)="onRowClick(row)"
      [class.row-is-clicked]="clickedRows.has(row.isbn)"
      *matRowDef="let row; columns: displayedColumns;"
    ></tr>
    <!-- Row shown when there is no matching data. -->
    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell" colspan="4">No data matching the filter "{{input.value}}"</td>
    </tr>
  </table>
</div>

<div>
  <h3>
    Click Log
  </h3>
</div>

@if (!clickedRows.size) {
  <div>Clicked rows will be logged here</div>
}

<ul>
  @for (clickedRow of getListItemClicked(); track clickedRow) {
    <li>Clicked on {{clickedRow}}</li>
  }
</ul>

<mat-toolbar class="bottom-toolbar">
  <div class="toolbar-content">
    <span [class.total-price-small]="(appComponent.isSmall$ | async)?.valueOf()">Total price:
      <span style="font-weight: bold">
        {{getTotalPrice() | currency:'VND':'symbol':'1.0-0'}}
      </span>
    </span>
    <button mat-flat-button *ngIf="clickedRows.size > 0" (click)="checkoutSelected()">Buy now</button>
  </div>
</mat-toolbar>
